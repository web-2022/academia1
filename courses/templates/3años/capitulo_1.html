{% extends 'courses/base.html' %}

{% block title %}Capítulo 1: Números y Contar{% endblock %}

{% block content %}
<style>
  body {
    background-color: #f0f0f0;
    padding-left: 0; /* Avoid body left padding caused by .sidebar */
  }

  .sidebar {
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    width: 250px;
    overflow-y: auto;
  }

  .list-group-item a {
    text-decoration: none;
    color: #007bff;
  }

  .list-group-item a:hover {
    text-decoration: underline;
  }

  #ball-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }

  .ball {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(circle at 50% 50%, #ffffff, #0000ff);
    animation: rotate 10s linear infinite;
  }

  .option-btn {
    margin: 5px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
    cursor: pointer;
  }

  .option-btn:hover {
    background-color: #f0f0f0;
  }

  /* Responsive design adjustments */
  @media (max-width: 768px) {
    .list-group-item {
      flex: 1 1 45%; /* Items will take 45% of width on smaller screens */
    }
  }

  @media (max-width: 480px) {
    .list-group-item {
      flex: 1 1 100%; /* Items will take full width on very small screens */
    }
  }
</style>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar for chapters -->
    <div class="row p-3 d-flex justify-content-center">
      
      <ul class="list-group list-group-horizontal d-flex flex-wrap">
        <li class="list-group-item flex-fill">
          <a href="{% url 'capitulo' capitulo_id=1 %}">Capítulo 1: Números y Contar</a>
        </li>
        <li class="list-group-item flex-fill">
          <a href="{% url 'capitulo' capitulo_id=2 %}">Capítulo 2: Sumas y Restas</a>
        </li>
        <li class="list-group-item flex-fill">
          <a href="{% url 'capitulo' capitulo_id=3 %}">Capítulo 3: Multiplicaciones</a>
        </li>
        <li class="list-group-item flex-fill">
          <a href="{% url 'capitulo' capitulo_id=4 %}">Capítulo 4: División</a>
        </li>
      </ul>
    </div>
    <!-- Main content -->
    <div class="col-md-9 offset-md-3">
      <div class="text-center mt-5">
        <div class="btn-group mt-5" role="group">
          <button id="generate-btn-10" class="btn btn-primary">Generar Pelotas (1-10)</button>
          <button id="generate-btn-20" class="btn btn-secondary">Generar Pelotas (1-20)</button>
          <button id="generate-btn-30" class="btn btn-success">Generar Pelotas (1-30)</button>
        </div>
        <div id="ball-container" class="mt-4"></div>
        <div id="options-container" class="mt-4">
          <h3 class="text-primary">¿Cuántas pelotas hay?</h3>
          <div id="options" class="d-flex justify-content-center"></div>
          <div id="result" class="mt-3"></div> <!-- Container for result message -->
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}



<script>
  // JavaScript functions for generating balls and handling options
  function getRandomNumber(max) {
    return Math.floor(Math.random() * max) + 1;
  }

  function getRandomOptions(correctResult, limit) {
    let options = new Set();
    options.add(correctResult);

    while (options.size < 5) {
      let randomOption = getRandomNumber(limit * 2) - 1;
      if (randomOption !== correctResult && randomOption > 0 && randomOption < limit) {
        options.add(randomOption);
      }
    }

    return Array.from(options).sort(() => Math.random() - 0.5);
  }

  function updateResult(limit) {
    let num1, num2, result;
    do {
      num1 = getRandomNumber(limit);
      num2 = getRandomNumber(limit);
      result = num1 + num2;
    } while (result <= limit);

    document.getElementById('result').textContent = `${num1} + ${num2} = ?`;

    const options = getRandomOptions(result, limit);
    const optionsContainer = document.getElementById('options');
    optionsContainer.innerHTML = '';
    options.forEach(option => {
      const button = document.createElement('button');
      button.textContent = option;
      button.className = 'btn btn-primary m-2';
      button.addEventListener('click', () => {
        if (option === result) {
          document.getElementById('result').textContent = '¡Correcto!';
          setTimeout(() => updateResult(limit), 2000); // Wait 2 seconds and generate new sum
        } else {
          document.getElementById('result').textContent = 'Incorrecto. Inténtalo de nuevo.';
        }
      });
      optionsContainer.appendChild(button);
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('generate-btn-10').addEventListener('click', () => generateBalls(10));
    document.getElementById('generate-btn-20').addEventListener('click', () => generateBalls(20));
    document.getElementById('generate-btn-30').addEventListener('click', () => generateBalls(30));
  });
  
  

  function generateBalls(maxBalls) {
    const ballContainer = document.getElementById('ball-container');
    const optionsContainer = document.getElementById('options');
    const resultContainer = document.getElementById('result');

    ballContainer.innerHTML = ''; // Clear existing balls
    optionsContainer.innerHTML = ''; // Clear existing options
    resultContainer.innerHTML = ''; // Clear existing result message

    const numBalls = Math.floor(Math.random() * maxBalls) + 1; // Random number between 1 and maxBalls
    const rows = 3; // Number of rows
    const ballsPerRow = Math.ceil(numBalls / rows); // Number of balls per row

    for (let i = 0; i < numBalls; i++) {
      const ball = document.createElement('div');
      ball.className = 'ball';
      ball.style.width = '40px'; // Fixed size for uniformity
      ball.style.height = '40px'; // Fixed size for uniformity

      // Calculate position in grid
      const row = Math.floor(i / ballsPerRow);
      const column = i % ballsPerRow;

      // Adjust position and size
      ball.style.top = `${row * 60}px`; // 80px gap between rows
      ball.style.left = `${column * 60}px`; // 80px gap between columns

      ballContainer.appendChild(ball);
    }

    // Generate random options
    const correctAnswer = numBalls;
    const options = new Set();

    while (options.size < 4) {
      const randomOption = Math.floor(Math.random() * maxBalls) + 1;
      options.add(randomOption);
    }

    // Ensure the correct answer is included
    options.add(correctAnswer);

    // Shuffle options
    const shuffledOptions = Array.from(options).sort(() => Math.random() - 0.5);

    // Create option buttons
    shuffledOptions.forEach(option => {
      const button = document.createElement('button');
      button.className = 'option-btn';
      button.textContent = option;

      button.addEventListener('click', () => {
        if (option === correctAnswer) {
          resultContainer.textContent = '¡Correcto!';
          resultContainer.style.color = '#007bff'; // Use the same color as the buttons

          // Generate new balls after 3 seconds
          setTimeout(() => generateBalls(maxBalls), 3000);
        } else {
          resultContainer.textContent = 'Intenta de nuevo.';
          resultContainer.style.color = '#007bff'; // Use the same color as the buttons
        }
      });

      optionsContainer.appendChild(button);
    });
  }
</script>
